cat<<'EOT'>> samtools.sh
#!/bin/bash
#SBATCH -n 4
#SBATCH --mem-per-cpu=9G

file_path=$1

echo 'start alignment'

/scratch/groups/sgdp_nanopore/software/minimap2/minimap2 \
-a \
--MD \
-x map-ont \
/scratch/groups/sgdp_nanopore/Resources/human_g1k_v37.fasta \
${file_path} \
> aln.sam

module load apps/samtools

######output SAM file to BAM file
samtools view -S -b aln_large_indel.sam > mapped.bam

echo 'finished making bam'

#####sort the BAM file
samtools sort mapped.bam -o mapped.sorted.bam

echo 'finished sorting bam'

#####index the BAM file
samtools index mapped.sorted.bam

echo 'finished indexing bam'

#####see what the BAM file is like
samtools flagstat mapped.sorted.bam

echo 'run NanoStat for read info'

NanoStat --bam mapped.sorted.bam

echo 'make a vcf'

/scratch/groups/sgdp_nanopore/software/Sniffles-master/bin/sniffles-core-1.0.12/sniffles \
-m mapped.sorted.bam \
-v variants.vcf

EOT
